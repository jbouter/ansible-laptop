---

- name: install KDE packages
  pacman:
    state: present
    name:
      - latte-dock
      - kmail
      - korganizer

- name: check if kwalletcli is installed
  stat:
    path: /usr/bin/kwalletcli
  register: stat_kwalletcli

- name: clone visual studio code from aur
  become: yes
  become_user: "{{ username }}"
  git:
    repo: https://aur.archlinux.org/kwalletcli.git
    dest: /tmp/kwalletcli
    version: master
    update: yes
  when: not stat_kwalletcli.stat.exists

- name: install kwalletcli using makepkg
  become: yes
  become_user: "{{ username }}"
  command: makepkg --noconfirm -si
  args:
    chdir: /tmp/kwalletcli
    creates: /usr/bin/kwalletcli
  when: not stat_kwalletcli.stat.exists

- name: check if kwalletcli installation was succesful
  stat:
    path: /usr/bin/kwalletcli
  register: stat_kwalletcliinstalled

- name: remove kwalletcli cloned repository
  file:
    path: /tmp/kwalletcli
    state: absent
  when: stat_kwalletcliinstalled.stat.exists

- name: create sddm config dir
  file:
    path: /etc/sddm.conf.d
    state: directory
    owner: root
    group: root
    mode: '0755'

- name: configure sddm to use the breeze theme
  copy:
    dest: /etc/sddm.conf.d/breeze.conf
    owner: root
    group: root
    mode: '0644'
    content: |
        [Theme]
        Current=breeze
        CursorTheme=breeze_cursors
